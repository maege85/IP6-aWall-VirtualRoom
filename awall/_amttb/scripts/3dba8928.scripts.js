"use strict";function AdsRestService(a,b){this.getAll=function(c){var d=a.all(b);return d.getList(c)},this.get=function(c,d){var e=a.one(b,c);return e.get(d)},this.save=function(c){var d;if(void 0!==c.id){var e=a.one(b,c.id);d=e.customPUT(c)}else{var f=a.all(b);d=f.post(c)}return d},this.remove=function(c){var d=a.one(b,c.id);return d.customDELETE()},this.copy=function(b){return a.copy(b)}}angular.module("adswebApp",["ngRoute","ui.bootstrap","restangular","nsPopover","ngTouch"]).config(["$routeProvider","RestangularProvider",function(a,b){b.setBaseUrl("http://windows92.cs.technik.fhnw.ch/api"),b.addResponseInterceptor(function(a,b){return"getList"===b?a.items:a}),a.when("/",{redirectTo:"/taskboard/ATBD"}).when("/taskboard/:id",{templateUrl:"../views/taskboard.html",controller:"TaskboardCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("adswebApp").controller("SprintModalInstanceCtrl",["$scope","$modalInstance","action","item","Sprints",function(a,b,c,d,e){function f(){document.getElementById("sprint-button-save").disabled=!0,document.getElementById("sprint-button-cancel").disabled=!0,document.getElementById("sprint-button-remove").disabled=!0,document.getElementById("loading-icon").style.visibility="visible"}a.action=c,a.item=d,a.item.project={},a.item.project.id=a.project.id,a.item.project.name=a.project.name,a.cancel=function(){b.dismiss("cancel")},a.save=function(){f(),e.save(a.item).then(function(){b.close()})},a.remove=function(){f(),e.remove(a.item).then(function(){b.close()})}}]),angular.module("adswebApp").controller("UserstoryModalInstanceCtrl",["$scope","$modalInstance","action","item","Userstories","Userstorystates",function(a,b,c,d,e,f){function g(){document.getElementById("userstory-button-save").disabled=!0,document.getElementById("userstory-button-cancel").disabled=!0,document.getElementById("userstory-button-remove").disabled=!0,document.getElementById("loading-icon").style.visibility="visible"}a.action=c,a.item=d,a.item.tasks=null,f.getAll({userstory:d.id}).then(function(b){a.states=b}),a.cancel=function(){b.dismiss("cancel")},a.save=function(){g(),e.save(a.item).then(function(){b.close()})},a.remove=function(){g(),e.remove(a.item).then(function(){b.close()})}}]),angular.module("adswebApp").controller("TaskModalInstanceCtrl",["$scope","$modalInstance","action","item","Tasks","Taskstates",function(a,b,c,d,e,f){function g(){document.getElementById("task-button-save").disabled=!0,document.getElementById("task-button-cancel").disabled=!0,document.getElementById("task-button-remove").disabled=!0,document.getElementById("loading-icon").style.visibility="visible"}a.action=c,a.item=d,f.getAll({task:d.id}).then(function(b){a.states=b}),a.cancel=function(){b.dismiss("cancel")},a.save=function(){g(),e.save(a.item).then(function(){b.close()})},a.remove=function(){g(),e.remove(a.item).then(function(){b.close()})}}]),angular.module("adswebApp").controller("TaskboardCtrl",["$scope","$modal","$route","Projects",function(a,b,c,d){function e(){a.path="projects",a.sprintSelectionVisible="none",a.GreenHoppersprintSelectionVisible="none",a.sprintinfoVisible=!0,a.burnchartVisible=!0,a.teamboxVisible=!0,a.timerboxVisible=!0,a.stickerboxVisible=!0,f()}function f(){d.get(h,{expand:"all"}).then(function(b){a.project=b,a.people=b.people})}function g(c){var d=b.open({templateUrl:"views/sprint-edit-modal.html",controller:"SprintModalInstanceCtrl",scope:a,resolve:{action:function(){return void 0===c.id?"Create":"Edit"},item:function(){return c}}});d.result.then(function(){f()})}var h=c.current.params.id;e(),a.selectSprint=function(b){a.sprint=b,a.sprintSelectionVisible=!1,a.GreenHoppersprintSelectionVisible=!1},a.selectGreenHopperSprint=function(b){a.sprint=b,a.greenHoppersprint=b,a.sprintSelectionVisible=!1,a.GreenHoppersprintSelectionVisible=!0},a.showSprintSelection=function(){a.sprintSelectionVisible=!0,a.GreenHoppersprintSelectionVisible=!1,a.sprint=void 0,a.greenHoppersprint=void 0},a.addSprint=function(){g({})},a.editSprint=function(a){g(a)},a.clickBurnchart=function(){a.burnchartVisible=!a.burnchartVisible},a.clickTeambox=function(){a.teamboxVisible=!a.teamboxVisible},a.clickSprintinfo=function(){a.sprintinfoVisible=!a.sprintinfoVisible},a.clickTimerbox=function(){a.timerboxVisible=!a.timerboxVisible},a.clickStickerbox=function(){a.stickerboxVisible=!a.stickerboxVisible}}]),angular.module("adswebApp").controller("TaskboardSprintCtrl",["$scope","$modal","Userstories","Tasks","Taskstates","Stickers","StickerObjects",function(a,b,c,d,e,f,g){function h(){c.getAll({sprint:a.sprint.id,expand:"all"}).then(function(b){a.userstories=b,i(b)})}function i(a){a.forEach(function(a){d.getAll({userstory:a.id,expand:"all"}).then(function(b){a.tasks=b,j(b)})})}function j(a){a.forEach(function(a){k(a)})}function k(a){g.getAll({obj:"taskcard",objectId:a.id,expand:"all"}).then(function(b){a.stickers=b})}function l(){e.getAll({project:a.project.id}).then(function(b){a.taskStates=b})}function m(){f.getAll().then(function(b){a.stickers=b})}function n(c){var d=b.open({templateUrl:"views/userstory-edit-modal.html",controller:"UserstoryModalInstanceCtrl",scope:a,resolve:{action:function(){return void 0===c.id?"Create":"Edit"},item:function(){return c}}});d.result.then(function(){h()})}function o(c){var d=b.open({templateUrl:"views/task-edit-modal.html",controller:"TaskModalInstanceCtrl",scope:a,resolve:{action:function(){return void 0===c.id?"Create":"Edit"},item:function(){return c}}});d.result.then(function(){void 0===a.greenHoppersprint?h():(a.userstories=a.greenHoppersprint.userStories,i(a.userstories))})}a.$watch("sprint",function(){void 0!==a.sprint?(h(),l(),m()):a.userstories=void 0}),a.$watch("greenHoppersprint",function(){a.userstories=a.greenHoppersprint.userStories,i(a.userstories)}),a.addUserstory=function(){var b={};b.sprint=a.sprint,n(b)},a.editUserstory=function(a){n(c.copy(a))},a.saveTask=function(a){d.save(a)},a.addTask=function(a){var b={};b.userStory=a,o(b)},a.editTask=function(a){o(d.copy(a))},a.saveStickerObject=function(a,b){g.save(a).then(function(){k(b)})},a.getTasksOfUserstoryWithState=function(a,b){var c=[];return a.tasks.forEach(function(a){a.state.id===b.id&&c.push(a)}),c},a.getTasksOfGreenHopperUserstoryWithState=function(a,b){var c=[];return a.tasks.forEach(function(a){a.state.id===b.id&&c.push(a)}),c},a.sortExpression="-id"}]).filter("nullEnd",function(){return function(a,b){"-priority"===b&&(b="priority");var c=a.filter(function(a){return a[b]}),d=a.filter(function(a){return!a[b]});return c.concat(d)}}),angular.module("adswebApp").controller("userstoryinfo",["$scope",function(a){a.storyPoints=function(b){a.userstoryAll=0,a.userstoryDone=0,a.usPercentDone=0;var c=0;return angular.forEach(b,function(b){"Done"===b.state.name&&a.userstoryDone++,a.userstoryAll++,c+=b.storyPoints}),a.usPercentDone=(a.userstoryDone/a.userstoryAll*100).toFixed(2),c},a.taskAll=function(b){a.taskDone=0,a.taskPercentDone=0;var c=0;return angular.forEach(b,function(b){b.tasks.forEach(function(b){"Done"===b.state.name&&a.taskDone++,c++})}),a.taskPercentDone=(a.taskDone/c*100).toFixed(2),c}}]),angular.module("adswebApp").controller("sortableUS",function(){var a=function(a,b){return b.children().each(function(){$(this).width($(this).width())}),b};$("#UStable tbody").sortable({helper:a,cancel:".story-column,.addcard"}).disableSelection()}),angular.module("adswebApp").controller("TimerCtrl",["$scope","Timers",function(a,b){a.save=function(a){b.save(a)}}]),angular.module("adswebApp").controller("StickerCtrl",["$scope","Stickers",function(a,b){a.save=function(a){b.save(a)}}]),angular.module("adswebApp").controller("StickerObjectsCtrl",["$scope","StickerObjects",function(a,b){a.remove=function(a){b.remove(a)}}]),angular.module("adswebApp").controller("touchoncard",["$scope",function(a){var b=0,c=400;a.checkDoubleclick=function(){return b++,setTimeout(function(){b=0},c),2===b?(b=0,!1):!0}}]),angular.module("adswebApp").factory("Projects",["Restangular",function(a){return new AdsRestService(a,"projects")}]),angular.module("adswebApp").factory("People",["Restangular",function(a){return new AdsRestService(a,"people")}]),angular.module("adswebApp").factory("Sprints",["Restangular",function(a){return new AdsRestService(a,"sprints")}]),angular.module("adswebApp").factory("Userstories",["Restangular",function(a){return new AdsRestService(a,"userstories")}]),angular.module("adswebApp").factory("Userstorystates",["Restangular",function(a){return new AdsRestService(a,"userstorystates")}]),angular.module("adswebApp").factory("Tasks",["Restangular",function(a){return new AdsRestService(a,"tasks")}]),angular.module("adswebApp").factory("Timers",["Restangular",function(a){return new AdsRestService(a,"timer")}]),angular.module("adswebApp").factory("Stickers",["Restangular",function(a){return new AdsRestService(a,"stickers")}]),angular.module("adswebApp").factory("StickerObjects",["Restangular",function(a){return new AdsRestService(a,"stickerobjects")}]),angular.module("adswebApp").factory("Taskstates",["Restangular",function(a){return new AdsRestService(a,"taskstates")}]),angular.module("adswebApp").directive("sprintcard",function(){return{restrict:"E",scope:{sprint:"="},templateUrl:"views/sprint-card.html"}}),angular.module("adswebApp").directive("taskstate",function(){return{restrict:"A",link:function(a,b){$(b).droppable({accept:".taskcard-container",drop:function(b,c){var d=$(c.draggable).data("task");console.log(d.state.name+" -> "+a.state.name),d.state=a.state,a.saveTask(d)}})}}}),angular.module("adswebApp").directive("taskcard",function(){return{restrict:"A",link:function(a,b){$(b).draggable({revert:"invalid",zIndex:1e3,containment:"document",helper:"clone",cursor:"move",opacity:.7,distance:25,start:function(){$(b).data("task",a.task),$(b).find(".taskcard").css("background-color","lightblue")},stop:function(){$(b).find(".taskcard").animate({"background-color":"white"},1500)}}),$(b).droppable({accept:".teambox-avatar, sticker",drop:function(c,d){if(d.draggable.is(".teambox-avatar")){var e=null!==a.task.assignee?a.task.assignee.name:"None",f=$(d.draggable).data("person");console.log(e+" -> "+f.name),a.task.assignee=f,a.$apply(),a.saveTask(a.task)}else if(d.draggable.is("sticker")){var g=$(d.draggable).data("stickerData"),h={},i=0;h.obj="taskcard",h.objectId=a.task.id;var j=d.offset,k=$(b).offset();i=j.left-k.left<=$(b).width()/3?1:j.left-k.left<=$(b).width()/3+$(b).width()/3?2:3,j.top-k.top>=$(b).height()/2&&(i+=3),h.position=i,h.sticker=g,a.saveStickerObject(h,a.task)}}})}}}),angular.module("adswebApp").directive("teambox",function(){return{templateUrl:"views/teambox.html",restrict:"E",scope:{team:"="},link:function(a,b){var c=b.find(".box"),d=c.css("background-color");$("#resetteambox").mouseup(function(){$(b).hasClass("noclick")?$(b).removeClass("noclick"):(b.css("left","0px"),b.css("top","0px"),b.css("position","relative"))}),$(b).draggable({connectToSortable:"#sortable",cursor:"move",start:function(){c.css("background-color","lightcoral"),$(b).addClass("noclick")},stop:function(){c.css("background-color",d),setTimeout(function(){$(b).hasClass("noclick")&&$(b).removeClass("noclick")},300)}})}}}),angular.module("adswebApp").directive("timerbox",["$interval","$timeout","$route",function(a,b,c){var d,e,f,g,h,i,j,k={};return{templateUrl:"views/timerbox.html",restrict:"E",controller:"TimerCtrl",scope:{},link:function(l,m){$("#dialog-confirm").hide(),g=m.find(".box"),h=g.css("background-color"),i=a,j=b,l.totalSeconds=900,$("#reset").mouseup(function(){$(m).hasClass("noclick")?$(m).removeClass("noclick"):(m.css("left","0px"),m.css("top","0px"),m.css("position","relative"))}),$(m).draggable({connectToSortable:"#sortable",cursor:"move",start:function(){g.css("background-color","lightcoral"),$(m).addClass("noclick")},stop:function(){g.css("background-color",h),setTimeout(function(){$(m).hasClass("noclick")&&$(m).removeClass("noclick")},300)}}),l.timer=function(){e=100/l.totalSeconds,f=0,l.date=new Date,l.started=!1,l.paused=!1,l.drawCircle(),$(".percenttext").html('<button class="startTimer"><span class="glyphicon glyphicon-play"></span></button>'),i(function(){l.date=new Date},1e3),$(".startTimer").mousedown(function(){l.startTimer()})},l.startTimer=function(){l.started||(l.seconds=l.totalSeconds,k.starttime=new Date,$(".percenttext").html('<button class="pauseTimer"><span class="glyphicon glyphicon-pause"></span></button><button class="stopTimer"><span class="glyphicon glyphicon-stop"></span></button>'),d=i(function(){l.updateTimer()},1e3),l.started=!0)},l.updateTimer=function(){l.seconds--,f+=e,l.drawCircle(),$(".percenttext").html('<button class="pauseTimer"><span class="glyphicon glyphicon-pause"></span></button><button class="stopTimer"><span class="glyphicon glyphicon-stop"></span></button>'),$(".pauseTimer").mousedown(function(){l.pauseTimer()}),$(".stopTimer").mousedown(function(){l.stopTimer()}),0===l.seconds&&l.timeUp()},l.timeUp=function(){g.css("background-color","#ff0000"),g.fadeOut(500).fadeIn(500).fadeOut(500).fadeIn(500).fadeOut(500).fadeIn(500);var a=document.createElement("audio");a.setAttribute("src","alarm.mp3"),a.setAttribute("autoplay","autoplay"),$.get(),a.addEventListener("load",function(){a.play()},!0),j(function(){a.remove(),g.css("background-color",h)},3e3)},l.endTimer=function(){k.project=c.current.params.id,k.type="stand-up",k.duration=l.totalSeconds-l.seconds,k.allocated=l.totalSeconds,k.leader="?",l.save(k),f=0,l.drawCircle(),$(".percenttext").html('<button class="startTimer"><span class="glyphicon glyphicon-play"></span></button>'),$(".startTimer").mousedown(function(){l.startTimer()}),l.started=!1,l.paused=!1},l.pauseTimer=function(){l.paused||i.cancel(d),l.paused=!0,$(".percenttext").html('<button class="restartTimer"><span class="glyphicon glyphicon-play"></span></button><button class="stopTimer"><span class="glyphicon glyphicon-stop"></span></button>'),$(".restartTimer").mousedown(function(){l.restartTimer()}),$(".stopTimer").mousedown(function(){l.stopTimer()})},l.stopTimer=function(){l.pauseTimer(l),$(function(){$("#dialog-confirm").dialog({resizable:!1,modal:!0,position:{my:"center",at:"center",of:$(m)},buttons:{Yes:function(){$(this).dialog("close"),l.endTimer()},Cancel:function(){$(this).dialog("close")}}})})},l.restartTimer=function(){l.paused&&(d=i(function(){l.updateTimer()},1e3),l.paused=!1)},l.drawCircle=function(){$("#circle").progressCircle({nPercent:f,thickness:10,circleSize:140})},l.pretty=function(a){if(null!==a&&void 0!==a){for(var b=""+a;b.length<2;)b="0"+b;return b}},l.timer()}}}]),angular.module("adswebApp").directive("stickerbox",function(){return{templateUrl:"views/stickerbox.html",restrict:"E",controller:"StickerCtrl",scope:{stickers:"="},link:function(a,b){var c=b.find(".box"),d=c.css("background-color");$("#resetsticker").mouseup(function(){$(b).hasClass("noclick")?$(b).removeClass("noclick"):(b.css("left","0px"),b.css("top","0px"),b.css("position","relative"))}),$(b).draggable({connectToSortable:"#sortable",cursor:"move",start:function(){c.css("background-color","lightcoral"),$(b).addClass("noclick")},stop:function(){c.css("background-color",d),setTimeout(function(){$(b).hasClass("noclick")&&$(b).removeClass("noclick")},300)}})}}}),angular.module("adswebApp").directive("teamboxAvatar",function(){return{templateUrl:"views/teambox-avatar.html",restrict:"E",scope:{person:"="},transclude:!0,link:function(a,b){$(b).draggable({cursor:"move",cursorAt:{bottom:0,left:0},helper:function(){var a=$(this).clone(),b=$(this).parent();return a.width(b.width()),a.height(b.height()),a},scroll:!1,revert:"invalid",zIndex:1e3,appendTo:"body",start:function(){$(b).data("person",a.person)}})}}}),angular.module("adswebApp").directive("sticker",function(){return{templateUrl:"views/sticker.html",restrict:"E",scope:{sticker:"="},transclude:!0,link:function(a,b){$(b).draggable({cursor:"move",cursorAt:{bottom:0,left:0},helper:function(){var a=$(this).clone(),b=$(this).parent();return a.width(b.width()),a.height(b.height()),a},revert:"invalid",zIndex:1e3,appendTo:"body",start:function(){$(b).data("stickerData",a.sticker)}})}}}),angular.module("adswebApp").directive("stickerobject",function(){return{restrict:"A",controller:"StickerObjectsCtrl",scope:{stickerobject:"=",task:"="},link:function(a,b){var c=0,d=400;$(b).mousedown(function(){if(c++,setTimeout(function(){c=0},d),2===c){c=0;var b=a.task.stickers.indexOf(a.stickerobject);b>-1&&a.task.stickers.splice(b,1),a.remove(a.stickerobject)}})}}}),angular.module("adswebApp").directive("resizableCard",function(){return{restrict:"A",link:function(a,b){function c(){return parseInt(i.css("font-size").replace("px",""))}function d(){h.zIndex(localStorage.zIndexFront);var a=h.find(".pull-right"),b=$('<i class="glyphicon glyphicon-minus"></i>');0===h.has("i.glyphicon").length&&b.appendTo(a),b.mouseup(function(){h.zIndex(200),h.hasClass("storycard")?(h.height(72),h.width(200)):(h.height(k),h.width(l)),$(h).find(".position2").css("left","80px"),$(h).find(".position3").css("left","170px"),$(h).find(".position4").css("top","35px"),$(h).find(".position5").css("left","80px"),$(h).find(".position5").css("top","35px"),$(h).find(".position6").css("left","170px"),$(h).find(".position6").css("top","35px"),b.remove(),e()})}function e(){i.css("font-size",j),i.find("li").each(function(){$(this).addClass("hidden")});var a=i.find(".p1");a.removeClass("hidden")}function f(){var a=i.find("li").size(),c=0,d=0,e=0;for(i.css("font-size",j),i.find("li").each(function(){$(this).addClass("hidden")}),b=0;a>b;b++){var f=g(),k=f.outerHeight(),l=c+k;if(l>=h.height())break;f.removeClass("hidden"),e=b+1,c=l}if(e===a){c=i.outerHeight();for(var m=5;h.height()-c>m;)d+=.5,i.css("font-size",j+d),c=i.outerHeight();c+m>h.height()&&(d-=.5,i.css("font-size",j+d))}$(h).find(".position2").css("left",h.width()/2-20),$(h).find(".position3").css("left",h.width()-30),$(h).find(".position4").css("top",h.height()-25),$(h).find(".position5").css("left",h.width()/2-20),$(h).find(".position5").css("top",h.height()-25),$(h).find(".position6").css("left",h.width()-30),$(h).find(".position6").css("top",h.height()-25)}function g(){for(var a,b=1;5>=b;b++)if(a=i.find(":hidden.p"+b),a.length>0)return a.eq(0);return i.find(":hidden").eq(0)}var h=$(b),i=h.find(".card-content"),j=c(),k=h.height(),l=h.width();localStorage.zIndexFront=201,h.mousedown(function(){h.zIndex(localStorage.zIndexFront),localStorage.zIndexFront++}),h.resizable({handles:"se",start:function(){d()},resize:function(){f()}})}}}),angular.module("adswebApp").directive("burndownchart",function(){return{templateUrl:"views/burndownchart.html",restrict:"E",scope:{team:"="},link:function(a,b){var c=b.find(".box"),d=c.css("background-color");$("#resetburndown").mouseup(function(){$(b).hasClass("noclick")?$(b).removeClass("noclick"):(b.css("left","0px"),b.css("top","0px"),b.css("position","relative"))}),$(b).draggable({connectToSortable:"#sortable",cursor:"move",start:function(){c.css("background-color","lightcoral"),$(b).addClass("noclick")},stop:function(){c.css("background-color",d),setTimeout(function(){$(b).hasClass("noclick")&&$(b).removeClass("noclick")},300)}})}}}),angular.module("adswebApp").directive("sprintinfo",function(){return{templateUrl:"views/sprint-info.html",restrict:"E",link:function(a,b){var c=b.find(".box"),d=c.css("background-color");$("#resetsprintinfo").mouseup(function(){$(b).hasClass("noclick")?$(b).removeClass("noclick"):(b.css("left","0px"),b.css("top","0px"),b.css("position","relative"))}),$(b).draggable({connectToSortable:"#sortable",cursor:"move",start:function(){c.css("background-color","lightcoral"),$(b).addClass("noclick")},stop:function(){c.css("background-color",d),setTimeout(function(){$(b).hasClass("noclick")&&$(b).removeClass("noclick")},300)}})}}}),function(a){var b=a.module("sticky-footer",[]);b.directive("stickyFooter",["$timeout",function(a){return{restrict:"A",link:function(b,c,d){var e=$(d.stickyFooter);e.parents().css("height","100%"),e.css({"min-height":"100%",height:"auto"});var f=$('<div class="push"></div>');e.append(f);var g=function(){var a=c.outerHeight();f.height(a),e.css("margin-bottom",-a)};a(g,0),$(window).on("resize",g)}}}])}(window.angular),angular.module("adswebApp").directive("infoview",function(){return{restrict:"A",link:function(a,b){$(b).sortable()}}}),angular.module("adswebApp").filter("sortStates",function(){var a={Open:1,"In Progress":2,"To Verify":3,Done:4};return function(b){return b.sort(function(b,c){return a[b.name]>a[c.name]?1:-1})}});